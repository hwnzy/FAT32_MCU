C51 COMPILER V9.00   MAIN                                                                  08/19/2016 14:29:52 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN MAIN.OBJ
COMPILER INVOKED BY: D:\Keil\C51\BIN\C51.EXE MAIN.c COMPACT BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include "FAT.h"
   2          #include "LCD_12864.h"
   3          unsigned char * data file_cache;
   4          unsigned char xdata Cache0[512];
   5          unsigned char xdata Cache1[512];
   6          unsigned char data num[6];
   7          unsigned int times = 0;
   8          
   9          void NumToString5(unsigned int num_int,unsigned char *p)
  10          {          //65535
  11   1              if(num_int) {
  12   2                              p[0] = ('0'+(num_int/10000));
  13   2                              p[1] = ('0'+(num_int%10000/1000));
  14   2                              p[2] = ('0'+(num_int%10000%1000/100));
  15   2                              p[3] = ('0'+(num_int%10000%1000%100/10));       
  16   2                              p[4] = ('0'+(num_int%10000%1000%100%10));
  17   2                              p[5] = '\0';
  18   2              }
  19   1      }
  20                   
  21          void NumToString(unsigned char num_char,unsigned char *p)
  22          {
  23   1              if(num_char) {
  24   2                              p[0] = ('0'+(num_char/100));
  25   2                              p[1] = ('0'+((num_char%100)/10));
  26   2                              p[2] = ('0'+((num_char%100)%10));
  27   2                              p[3] = '\0';            
  28   2              }
  29   1      }
  30          
  31          void main()
  32          {
  33   1              unsigned int Len = 0;
  34   1              unsigned char code File[] = "VEDIO.BIN";
  35   1              file_cache = Cache0;
  36   1              Lcd12864Init();
  37   1              Lcd12864Printf(0,1,"FAT32 by nzy");
  38   1              Delay1s(1);
  39   1              Lcd12864Printf(0,2,"测试中...");
  40   1              switch(FATFSInitial(file_cache))
  41   1              {
  42   2                      case FATFS_FS_NOT_SUPPORT :     
  43   2                              Lcd12864Printf(0,3,"不是FAT系统"); break;
  44   2      
  45   2                      case FATFS_FATFS_NOT_SUPPORT :
  46   2                              Lcd12864Printf(0,3,"不支持FATFS");      break;
  47   2      
  48   2                      case FATFS_OPERATION_SUCCESS :
  49   2                              Lcd12864Printf(0,3,"操作成功"); break;
  50   2      
  51   2                      case FATFS_READ_BPB_SEC_ERROR :
  52   2                              Lcd12864Printf(0,3,"读BPB错误"); break;
  53   2                      
  54   2                      case FATFS_DEVICE_INITIAL_ERROR :
  55   2                              Lcd12864Printf(0,3,"初始化错误"); break;
C51 COMPILER V9.00   MAIN                                                                  08/19/2016 14:29:52 PAGE 2   

  56   2      
  57   2                      case FATFS_DEVICE_RESET_ERROR :
  58   2                              Lcd12864Printf(0,3,"复位错误"); break;
  59   2      
  60   2                      default :
  61   2                              Lcd12864Printf(0,3,"未知错误"); break;
  62   2              }
  63   1              Delay1s(1);
  64   1              Lcd12864ClearDDRAM();   
  65   1              Lcd12864Printf(0,1,"保留扇区");
  66   1              NumToString5(g_wRsvdSecCnt,num);  //数字转换为字符串
  67   1              Lcd12864Printf(0,2,num);
  68   1      
  69   1              Lcd12864Printf(0,3,"每簇扇区");
  70   1              NumToString(g_bSecPerClus,num);
  71   1              Lcd12864Printf(0,4,num);
  72   1      
  73   1              Delay1s(1);
  74   1              Lcd12864ClearDDRAM();
  75   1      
  76   1          Lcd12864Printf(0,1,"打开文件测试");
  77   1              Delay1s(1);
  78   1              Lcd12864Printf(0,2,"测试中...");
  79   1      
  80   1      
  81   1              switch(FATFSOpen(file_cache,File))
  82   1              {
  83   2                      case FATFS_FILENAME_ERROR :     
  84   2                              Lcd12864Printf(0,3,"文件命名失败"); break;
  85   2      
  86   2                      case FATFS_OPERATION_SUCCESS :
  87   2                              Lcd12864Printf(0,3,"操作成功"); break;
  88   2      
  89   2                      case FATFS_OPEN_FILE_FAILED :
  90   2                              Lcd12864Printf(0,3,"打开文件失败"); break;
  91   2      
  92   2                      case FATFS_FAT_REQUIRE_INITIAL :
  93   2                              Lcd12864Printf(0,3,"FAT没有初始化"); break;
  94   2      
  95   2                      default :
  96   2                              Lcd12864Printf(0,3,"未知错误"); break;
  97   2              }
  98   1      
  99   1              Delay1s(1);
 100   1              Lcd12864ClearDDRAM();
 101   1      
 102   1              Lcd12864Printf(0,1,"显示文件测试");
 103   1              Delay1s(1);
 104   1              Lcd12864Printf(0,2,"测试中...");
 105   1              Delay1s(1);
 106   1      
 107   1      
 108   1      
 109   1              switch(FATFSReadNextBlock(file_cache,&Len))
 110   1              {
 111   2                      case FATFS_READ_FAT_ERROR :     
 112   2                              Lcd12864Printf(0,3,"FAT读错误"); while(1);break;
 113   2              
 114   2                      case FATFS_RETAINED_CLUSTER :
 115   2                              Lcd12864Printf(0,3,"这是保留簇");       while(1);break;
 116   2      
 117   2                      case FATFS_BAD_CLUSTER :
C51 COMPILER V9.00   MAIN                                                                  08/19/2016 14:29:52 PAGE 3   

 118   2                              Lcd12864Printf(0,3,"只是坏簇"); while(1);break;
 119   2      
 120   2                      case FATFS_LAST_CLUSTER :
 121   2                              Lcd12864Printf(0,3,"这是最后簇"); while(1);break;
 122   2      
 123   2                      case FATFS_END_OF_FILE :
 124   2                              Lcd12864Printf(0,3,"文件末尾"); while(1);break;
 125   2      
 126   2                      case FATFS_READ_SEC_ERROR :
 127   2                              Lcd12864Printf(0,3,"读扇区错误"); while(1);break;
 128   2              
 129   2                      case FATFS_OPERATION_SUCCESS :
 130   2                              Lcd12864Printf(0,3,"操作成功"); times++;break;
 131   2              
 132   2                      case FATFS_READ_BLOCK_OVERRANG :                   
 133   2                              Lcd12864Printf(0,3,"读最后扇区"); while(1);break;
 134   2              
 135   2                      default :
 136   2                              Lcd12864Printf(0,3,"未知错误"); while(1);break;
 137   2              }
 138   1              NumToString5(times,num);
 139   1              Lcd12864Printf(0,4,num);                                         
 140   1              
 141   1      
 142   1              Lcd12864ClearDDRAM();
 143   1              Lcd12864ClearGDRAM();
 144   1              WriteCommand(0x36);//打开扩展功能模式，打开绘图显示
 145   1              while(1) {
 146   2                      Lcd12864Play(file_cache);
 147   2                      FATFSReadNextBlock(file_cache,&Len);            
 148   2              }
 149   1              while(1);
 150   1              /*      
 151   1              lcd_12864_display_words(0,1,"sprintf检验");
 152   1              NumToString(abcd,num);
 153   1              lcd_12864_display_words(0,2,num);
 154   1              while(1);
 155   1              */
 156   1      }
 157          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1030    ----
   CONSTANT SIZE    =    261    ----
   XDATA SIZE       =   1024    ----
   PDATA SIZE       =      2       7
   DATA SIZE        =      9    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
